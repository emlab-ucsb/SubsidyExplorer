---
output:
  html_document: default

title: "Paper # 1 - Figures"
author: "Kat Millage"
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 11pt
---

# Description

```{r setup, include=FALSE}
# Load packages
library(knitr) 
library(countrycode) # country name matching
library(sf)
library(rworldmap)
library(rmapshaper)
library(RColorBrewer)
library(cowplot)
library(tidyverse)

source(here::here("functions", "MapMaker.R"))

# Path to cleaned subsidies data file
subsidy_dat_sumaila_path <- here::here("data", "edited", "sumaila_et_al_2019_subsidies_tidy.csv")

# Path to binned effort data file
effort_dat_binned_path <- here::here("results", "02-vessel-list", "effort_binned_good_fishing_vessels_2018_raw.csv")

# Path to upsides data file 
upsides_dat_path <- here::here("data", "edited", "costello_et_al_2016_upsides_tidy.csv")

# Chunk options
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F, prompt = F, error = F)

# Directories for the output files generated by this script
results_dir <- here::here("papers", "paper-1/")
if (dir.exists(results_dir) == F) {
  dir.create(results_dir, recursive = T)
}
```

```{r}
# Land shapefile
world_land <- st_as_sf(rworldmap::countriesLow) ## data(countriesLow) is from the rworldmap package

# FAO regions
fao_regions <- read_sf(here::here("data", "shapefiles", "fao"), layer = "World_Fao_Zones") %>%
  rename(fao_region = zone) %>%
  rmapshaper::ms_simplify(keep = 0.05)
```

# Version 1: Binned effort and median F/Fmsy by FAO region

```{r}
effort_binned_good_fishing_vessels_2018 <- read_csv(effort_dat_binned_path)
```

# Correct outdated flag codes and Identify EU and USA dependent vessels

Before allocating catches and subsidies across vessels, we need to identify vessels flagged to states that are overseas dependencies of the EU or USA. We assume that these vessels recieve subsidies from their sovereign states and therefore their fishing efforts should be included in the totals. 

```{r}
# Load country dependencies helper file
country_dependencies <- read_csv(here::here("data", "lookup-tables", "country_dependencies.csv"))

# Netherlands overseas territories
nld_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "NLD"]

# France overseas territories
fra_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "FRA"]

# Denmark overseas territories
dnk_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "DNK"]

# British overseas territories
gbr_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "GBR"]

# Norway overseas territories
nor_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "NOR"]

# US overseas territories:  American Samoa, Guam, Northern Marianas Islands, Puerto Rico, US Virgin Islands
usa_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "USA"]

# Australian overseas territories: Christmas Island
aus_territories <- country_dependencies$iso3[country_dependencies$is_overseas_territory & country_dependencies$sovereign_iso3 == "AUS"]
```

We apply these to our binned fishing effort

```{r}
effort_binned <- effort_binned_good_fishing_vessels_2018 %>%
  mutate(new_flag = case_when(flag %in% nld_territories ~ "NLD",
                              flag %in% fra_territories ~ "FRA",
                              flag %in% dnk_territories ~ "DNK",
                              flag %in% gbr_territories ~ "GBR",
                              flag %in% nor_territories ~ "NOR",
                              flag %in% usa_territories ~ "USA",
                              flag %in% aus_territories ~ "AUS",
                              flag == "COK" ~ "NZL", # for now assign cook islands to new zealand
                              TRUE ~ flag))

effort_binned$new_flag[effort_binned$new_flag == "GCA"] <- "GTM"
effort_binned$new_flag[effort_binned$new_flag == "ROM"] <- "ROU"
effort_binned$new_flag[effort_binned$new_flag == "UNK"] <- NA
```

### Subsidy intensities

Now lets get fishing effort totals by flag state

```{r}
effort_totals_flag <- effort_binned %>%
  group_by(new_flag) %>%
  summarize(fishing_KWh_lat_lon = sum(fishing_KWh_lat_lon, na.rm = T),
            fishing_hours_lat_lon = sum(fishing_hours_lat_lon, na.rm = T))
```

We then load our subsidy data, and calculate subsidy rates by flag for 2018. Subsidy rates are then applied to our binned effort data by flag. 

```{r}
subsidy_dat_sumaila <- read_csv(subsidy_dat_sumaila_path) %>%
  group_by(iso3, category) %>%
  summarize(subs = sum(value, na.rm = T)) %>%
  spread(category, subs) %>%
  rename(A_subs = A,
         B_subs = B,
         C_subs = C) %>%
  mutate(BC_subs = B_subs + C_subs,
         tot_subs = A_subs + B_subs + C_subs)
```

```{r}
# Calculate subsidy rates by flag
subsidy_rates_flag <- effort_totals_flag %>%
  left_join(subsidy_dat_sumaila, by = c("new_flag" = "iso3")) %>%
  mutate(A_subs_KWh = A_subs/fishing_KWh_lat_lon,
         B_subs_KWh = B_subs/fishing_KWh_lat_lon,
         C_subs_KWh = C_subs/fishing_KWh_lat_lon,
         BC_subs_KWh = BC_subs/fishing_KWh_lat_lon,
         tot_subs_KWh = tot_subs/fishing_KWh_lat_lon) %>%
  dplyr::select(new_flag, contains("subs_KWh"))

# Apply subsidy rates to binned effort
effort_binned_sub_intensity <- effort_binned %>%
  left_join(subsidy_rates_flag, by = "new_flag") %>%
  mutate(B_subs = B_subs_KWh*fishing_KWh_lat_lon,
         BC_subs = BC_subs_KWh*fishing_KWh_lat_lon,
         C_subs = C_subs_KWh*fishing_KWh_lat_lon,
         tot_subs = tot_subs_KWh*fishing_KWh_lat_lon)

# Summarize by lat/lon
subsidy_intensity_binned <- effort_binned_sub_intensity %>%
  group_by(lat_bin_center, lon_bin_center) %>%
  summarize(med_B_subs_KWh = median(B_subs_KWh, na.rm = T),
            med_BC_subs_KWh = median(BC_subs_KWh, na.rm = T),
            med_tot_subs_KWh = median(tot_subs_KWh, na.rm = T),
            mean_B_subs_KWh = mean(B_subs_KWh, na.rm = T),
            mean_BC_subs_KWh = mean(BC_subs_KWh, na.rm = T),
            mean_tot_subs_KWh = mean(tot_subs_KWh, na.rm = T),
            w_mean_B_subs_KWh = weighted.mean(B_subs_KWh, w = fishing_KWh_lat_lon, na.rm = T),
            w_mean_BC_subs_KWh = weighted.mean(BC_subs_KWh, w = fishing_KWh_lat_lon, na.rm = T),
            w_mean_tot_subs_KWh = weighted.mean(tot_subs_KWh, w = fishing_KWh_lat_lon, na.rm = T),
            B_subs = sum(B_subs, na.rm = T),
            BC_subs = sum(BC_subs, na.rm = T),
            C_subs = sum(C_subs, na.rm = T),
            tot_subs = sum(tot_subs, na.rm = T),
            tot_fishing_KWh = sum(fishing_KWh_lat_lon, na.rm = T))

# Summarize by fao region
subsidy_intensity_region <- effort_binned_sub_intensity %>%
  group_by(fao_region) %>%
  summarize(med_B_subs_KWh = median(B_subs_KWh, na.rm = T),
            med_BC_subs_KWh = median(BC_subs_KWh, na.rm = T),
            med_tot_subs_KWh = median(tot_subs_KWh, na.rm = T),
            mean_B_subs_KWh = mean(B_subs_KWh, na.rm = T),
            mean_BC_subs_KWh = mean(BC_subs_KWh, na.rm = T),
            mean_tot_subs_KWh = mean(tot_subs_KWh, na.rm = T),
            w_mean_B_subs_KWh = weighted.mean(B_subs_KWh, w = fishing_KWh_lat_lon, na.rm = T),
            w_mean_BC_subs_KWh = weighted.mean(BC_subs_KWh, w = fishing_KWh_lat_lon, na.rm = T),
            w_mean_tot_subs_KWh = weighted.mean(tot_subs_KWh, w = fishing_KWh_lat_lon, na.rm = T),
            B_subs = sum(B_subs, na.rm = T),
            BC_subs = sum(BC_subs, na.rm = T),
            C_subs = sum(C_subs, na.rm = T),
            tot_subs = sum(tot_subs, na.rm = T),
            tot_fishing_KWh = sum(fishing_KWh_lat_lon, na.rm = T))
```

Now we go back to our effort data, and apply our subsidy rates. 

## Total Subsidies

### Subsidy Intensities by Lat/Lon

```{r}
# Median
median_subsidy_intensity_tot_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "med_tot_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,8, by = 2),
                                                  fill_limits = c(0,8),
                                                  fill_labels = c("0", "2", "4", "6", "\u2265 8"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "median_subsidy_intensity_tot_grid_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_subsidy_intensity_tot_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "mean_tot_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,8, by = 2),
                                                  fill_limits = c(0,8),
                                                  fill_labels = c("0", "2", "4", "6", "\u2265 8"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "mean_subsidy_intensity_tot_grid_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_subsidy_intensity_tot_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "w_mean_tot_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,8, by = 2),
                                                  fill_limits = c(0,8),
                                                  fill_labels = c("0", "2", "4", "6", "\u2265 8"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "w_mean_subsidy_intensity_tot_grid_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
intensity_tot_grid_legend <- get_legend(w_mean_subsidy_intensity_tot_grid_map)

subsidy_intensity_tot_grid_map <- plot_grid(median_subsidy_intensity_tot_grid_map + theme(legend.position = "none"),
                                            mean_subsidy_intensity_tot_grid_map + theme(legend.position = "none"),
                                            w_mean_subsidy_intensity_tot_grid_map + theme(legend.position = "none"),
                                            intensity_tot_grid_legend,
                                            ncol = 1,
                                            rel_heights = c(1,1,1,0.2),
                                            labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                            label_x = c(-0.04,-0.03,-0.1,0),
                                            align = "v")

ggsave(paste0(results_dir, "subsidy_intensity_tot_grid_map.png"), dpi = 200, width = 7, height = 12.5)

```

### Subsidy Intensities by Region

```{r}
# Median
median_subsidy_intensity_tot_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "med_tot_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,8, by = 2),
                                                  fill_limits = c(0,8),
                                                  fill_labels = c("0", "2", "4", "6", "\u2265 8"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "median_subsidy_intensity_tot_region_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_subsidy_intensity_tot_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "mean_tot_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,8, by = 2),
                                                  fill_limits = c(0,8),
                                                  fill_labels = c("0", "2", "4", "6", "\u2265 8"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "mean_subsidy_intensity_tot_region_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_subsidy_intensity_tot_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "w_mean_tot_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,8, by = 2),
                                                  fill_limits = c(0,8),
                                                  fill_labels = c("0", "2", "4", "6", "\u2265 8"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "w_mean_subsidy_intensity_tot_region_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
intensity_tot_region_legend <- get_legend(w_mean_subsidy_intensity_tot_region_map)

subsidy_intensity_tot_region_map <- plot_grid(median_subsidy_intensity_tot_region_map + theme(legend.position = "none"),
                                            mean_subsidy_intensity_tot_region_map + theme(legend.position = "none"),
                                            w_mean_subsidy_intensity_tot_region_map + theme(legend.position = "none"),
                                            intensity_tot_region_legend,
                                            ncol = 1,
                                            rel_heights = c(1,1,1,0.2),
                                            labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                            label_x = c(-0.04,-0.03,-0.1,0),
                                            align = "v")

ggsave(paste0(results_dir, "subsidy_intensity_tot_region_map.png"), dpi = 200, width = 7, height = 12.5)

```

```{r, fig.width=14, fig.height=12.5}
# Combine into six panel
subsidy_intensity_tot_noleg <- plot_grid(median_subsidy_intensity_tot_grid_map + theme(legend.position = "none"),
                                         median_subsidy_intensity_tot_region_map + theme(legend.position = "none"),
                                         mean_subsidy_intensity_tot_grid_map + theme(legend.position = "none"),
                                         mean_subsidy_intensity_tot_region_map + theme(legend.position = "none"),
                                         w_mean_subsidy_intensity_tot_grid_map + theme(legend.position = "none"),
                                         w_mean_subsidy_intensity_tot_region_map + theme(legend.position = "none"),
                                         ncol = 2,
                                         labels = c("A) Median", "", "B) Mean", "", "C) Weighted Mean", ""),
                                         label_x = c(-0.04, 0, -0.03,0, -0.1, 0))

subsidy_intensity_tot_map <- plot_grid(subsidy_intensity_tot_noleg,
                                       intensity_tot_region_legend,
                                       rel_heights = c(2,0.2),
                                       ncol = 1)

subsidy_intensity_tot_map
ggsave(paste0(results_dir, "subsidy_intensity_tot_map.png"), dpi = 200, width = 14, height = 12.5)
```


## Bad Subsidies

### Subsidy Intensities by Lat/Lon

```{r}
# Median
median_subsidy_intensity_B_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "med_B_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "median_subsidy_intensity_B_grid_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_subsidy_intensity_B_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "mean_B_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "mean_subsidy_intensity_B_grid_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_subsidy_intensity_B_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "w_mean_B_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "w_mean_subsidy_intensity_B_grid_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
intensity_B_grid_legend <- get_legend(w_mean_subsidy_intensity_B_grid_map)

subsidy_intensity_B_grid_map <- plot_grid(median_subsidy_intensity_B_grid_map + theme(legend.position = "none"),
                                            mean_subsidy_intensity_B_grid_map + theme(legend.position = "none"),
                                            w_mean_subsidy_intensity_B_grid_map + theme(legend.position = "none"),
                                            intensity_B_grid_legend,
                                            ncol = 1,
                                            rel_heights = c(1,1,1,0.2),
                                            labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                            label_x = c(-0.04,-0.03,-0.1,0),
                                            align = "v")

ggsave(paste0(results_dir, "subsidy_intensity_B_grid_map.png"), dpi = 200, width = 7, height = 12.5)

```

### Subsidy Intensities by Region

```{r}
# Median
median_subsidy_intensity_B_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "med_B_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 >6"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "median_subsidy_intensity_B_region_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_subsidy_intensity_B_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "mean_B_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "mean_subsidy_intensity_B_region_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_subsidy_intensity_B_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "w_mean_B_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "w_mean_subsidy_intensity_B_region_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
intensity_B_region_legend <- get_legend(w_mean_subsidy_intensity_B_region_map)

subsidy_intensity_B_region_map <- plot_grid(median_subsidy_intensity_B_region_map + theme(legend.position = "none"),
                                            mean_subsidy_intensity_B_region_map + theme(legend.position = "none"),
                                            w_mean_subsidy_intensity_B_region_map + theme(legend.position = "none"),
                                            intensity_B_region_legend,
                                            ncol = 1,
                                            rel_heights = c(1,1,1,0.2),
                                            labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                            label_x = c(-0.04,-0.03,-0.1,0),
                                            align = "v")

ggsave(paste0(results_dir, "subsidy_intensity_B_region_map.png"), dpi = 200, width = 7, height = 12.5)

```

```{r, fig.width=14, fig.height=12.5}
# Combine into six panel
subsidy_intensity_B_noleg <- plot_grid(median_subsidy_intensity_B_grid_map + theme(legend.position = "none"),
                                       median_subsidy_intensity_B_region_map + theme(legend.position = "none"),
                                       mean_subsidy_intensity_B_grid_map + theme(legend.position = "none"),
                                       mean_subsidy_intensity_B_region_map + theme(legend.position = "none"),
                                       w_mean_subsidy_intensity_B_grid_map + theme(legend.position = "none"),
                                       w_mean_subsidy_intensity_B_region_map + theme(legend.position = "none"),
                                       ncol = 2,
                                       labels = c("A) Median", "", "B) Mean", "", "C) Weighted Mean", ""),
                                       label_x = c(-0.04, 0, -0.03,0, -0.1, 0))

subsidy_intensity_B_map <- plot_grid(subsidy_intensity_B_noleg,
                                       intensity_B_region_legend,
                                       rel_heights = c(2,0.2),
                                       ncol = 1)

subsidy_intensity_B_map

ggsave(paste0(results_dir, "subsidy_intensity_B_map.png"), dpi = 200, width = 14, height = 12.5)
```

## Bad + Ambiguous Subsidies

### Subsidy Intensities by Lat/Lon

```{r}
# Median
median_subsidy_intensity_BC_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "med_BC_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "median_subsidy_intensity_BC_grid_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_subsidy_intensity_BC_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "mean_BC_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "mean_subsidy_intensity_BC_grid_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_subsidy_intensity_BC_grid_map <- MapMaker(data = subsidy_intensity_binned,
                                                  res = "grid",
                                                  x = "lon_bin_center",
                                                  y = "lat_bin_center",
                                                  fill = "w_mean_BC_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land)

ggsave(paste0(results_dir, "w_mean_subsidy_intensity_BC_grid_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
intensity_BC_grid_legend <- get_legend(w_mean_subsidy_intensity_BC_grid_map)

subsidy_intensity_BC_grid_map <- plot_grid(median_subsidy_intensity_BC_grid_map + theme(legend.position = "none"),
                                            mean_subsidy_intensity_BC_grid_map + theme(legend.position = "none"),
                                            w_mean_subsidy_intensity_BC_grid_map + theme(legend.position = "none"),
                                            intensity_BC_grid_legend,
                                            ncol = 1,
                                            rel_heights = c(1,1,1,0.2),
                                            labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                            label_x = c(-0.04,-0.03,-0.1,0),
                                            align = "v")


ggsave(paste0(results_dir, "subsidy_intensity_BC_grid_map.png"), dpi = 200, width = 7, height = 12.5)

```

### Subsidy Intensities by Region

```{r}
# Median
median_subsidy_intensity_BC_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "med_BC_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "median_subsidy_intensity_BC_region_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_subsidy_intensity_BC_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "mean_BC_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "mean_subsidy_intensity_BC_region_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_subsidy_intensity_BC_region_map <- MapMaker(data = subsidy_intensity_region,
                                                  res = "region",
                                                  fill = "w_mean_BC_subs_KWh",
                                                  fill_name = "Subsidy Intensity \n($/KWh)",
                                                  fill_breaks = seq(0,6, by = 2),
                                                  fill_limits = c(0,6),
                                                  fill_labels = c("0", "2", "4", "\u2265 6"),
                                                  land_sf = world_land,
                                                  region_sf = fao_regions)

ggsave(paste0(results_dir, "w_mean_subsidy_intensity_BC_region_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
intensity_BC_region_legend <- get_legend(w_mean_subsidy_intensity_BC_region_map)

subsidy_intensity_BC_region_map <- plot_grid(median_subsidy_intensity_BC_region_map + theme(legend.position = "none"),
                                            mean_subsidy_intensity_BC_region_map + theme(legend.position = "none"),
                                            w_mean_subsidy_intensity_BC_region_map + theme(legend.position = "none"),
                                            intensity_BC_region_legend,
                                            ncol = 1,
                                            rel_heights = c(1,1,1,0.2),
                                            labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                            label_x = c(-0.04,-0.03,-0.1,0),
                                            align = "v")

ggsave(paste0(results_dir, "subsidy_intensity_BC_region_map.png"), dpi = 200, width = 7, height = 12.5)

```

```{r, fig.width=14, fig.height=12.5}
# Combine into six panel
subsidy_intensity_BC_noleg <- plot_grid(median_subsidy_intensity_BC_grid_map + theme(legend.position = "none"),
                                       median_subsidy_intensity_BC_region_map + theme(legend.position = "none"),
                                       mean_subsidy_intensity_BC_grid_map + theme(legend.position = "none"),
                                       mean_subsidy_intensity_BC_region_map + theme(legend.position = "none"),
                                       w_mean_subsidy_intensity_BC_grid_map + theme(legend.position = "none"),
                                       w_mean_subsidy_intensity_BC_region_map + theme(legend.position = "none"),
                                       ncol = 2,
                                       labels = c("A) Median", "", "B) Mean", "", "C) Weighted Mean", ""),
                                       label_x = c(-0.04, 0, -0.03,0, -0.1, 0))

subsidy_intensity_BC_map <- plot_grid(subsidy_intensity_BC_noleg,
                                       intensity_BC_region_legend,
                                       rel_heights = c(2,0.2),
                                       ncol = 1)

subsidy_intensity_BC_map

ggsave(paste0(results_dir, "subsidy_intensity_BC_map.png"), dpi = 200, width = 14, height = 12.5)
```

## Stock status 

Now we load the upsides database, calculate mean and median F/Fmsy by FAO region, and plot. 

```{r}
upsides_dat <- read_csv(upsides_dat_path) 

upsides_region <- upsides_dat %>%
  group_by(region_fao_split) %>%
  summarize(mean_f_v_fmsy = mean(fv_fmsy, na.rm = T),
            w_mean_f_v_fmsy = weighted.mean(fv_fmsy, w = msy, na.rm = T),
            med_f_v_fmsy = median(fv_fmsy, na.rm = T),
            mean_b_v_bmsy = mean(bv_bmsy, na.rm = T),
            w_mean_b_v_bmsy = weighted.mean(bv_bmsy, w = msy, na.rm = T),
            med_b_v_bmsy = median(bv_bmsy, na.rm = T),
            tot_msy = sum(msy, na.rm = T)) %>%
  rename(fao_region = region_fao_split)

```

### F/Fmsy by Region

```{r}
# Median
median_f_v_fmsy_region_map <- MapMaker(data = upsides_region, 
                                     res = "region",
                                     fill = "med_f_v_fmsy",
                                     fill_name = "F/Fmsy",
                                     fill_breaks = seq(0,4, by = 1),
                                     fill_limits = c(0,4),
                                     fill_labels = c("0", "1", "2", "3", "\u2265 4"),
                                     land_sf = world_land,
                                     region_sf = fao_regions)

ggsave(paste0(results_dir, "median_f_v_fmsy_region_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_f_v_fmsy_region_map <- MapMaker(data = upsides_region, 
                                     res = "region",
                                     fill = "mean_f_v_fmsy",
                                     fill_name = "F/Fmsy",
                                     fill_breaks = seq(0,4, by = 1),
                                     fill_limits = c(0,4),
                                     fill_labels = c("0", "1", "2", "3", "\u2265 4"),
                                     land_sf = world_land,
                                     region_sf = fao_regions)

ggsave(paste0(results_dir, "mean_f_v_fmsy_region_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_f_v_fmsy_region_map <- MapMaker(data = upsides_region, 
                                     res = "region",
                                     fill = "w_mean_f_v_fmsy",
                                     fill_name = "F/Fmsy",
                                     fill_breaks = seq(0,4, by = 1),
                                     fill_limits = c(0,4),
                                     fill_labels = c("0", "1", "2", "3", "\u2265 4"),
                                     land_sf = world_land,
                                     region_sf = fao_regions)

ggsave(paste0(results_dir, "w_mean_f_v_fmsy_region_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
f_v_fmsy_region_legend <- get_legend(w_mean_f_v_fmsy_region_map)

f_v_fmsy_region_map <- plot_grid(median_f_v_fmsy_region_map + theme(legend.position = "none"),
                                 mean_f_v_fmsy_region_map + theme(legend.position = "none"),
                                 w_mean_f_v_fmsy_region_map + theme(legend.position = "none"),
                                 f_v_fmsy_region_legend,
                                 ncol = 1,
                                 rel_heights = c(1, 1, 1, 0.2),
                                 labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                 label_x = c(-0.04, -0.03, -0.1, 0),
                                 align = "v")

f_v_fmsy_region_map
ggsave(paste0(results_dir, "f_v_fmsy_region_map.png"), dpi = 200, width = 7, height = 12.5)
```

### B/Bmsy by Region

```{r}
# Median
median_b_v_bmsy_region_map <- MapMaker(data = upsides_region, 
                                     res = "region",
                                     fill = "med_b_v_bmsy",
                                     fill_name = "B/Bmsy",
                                     fill_breaks = seq(0,2, by = 0.5),
                                     fill_limits = c(0,2),
                                     fill_labels = c("0", "0.5", "1", "1.5", "\u2265 2"),
                                     land_sf = world_land,
                                     region_sf = fao_regions)

ggsave(paste0(results_dir, "median_b_v_bmsy_region_map.png"), dpi = 200, width = 7, height = 5)

# Mean
mean_b_v_bmsy_region_map <- MapMaker(data = upsides_region, 
                                     res = "region",
                                     fill = "mean_b_v_bmsy",
                                     fill_name = "B/Bmsy",
                                     fill_breaks = seq(0,2, by = 0.5),
                                     fill_limits = c(0,2),
                                     fill_labels = c("0", "0.5", "1", "1.5", "\u2265 2"),
                                     land_sf = world_land,
                                     region_sf = fao_regions)

ggsave(paste0(results_dir, "mean_b_v_bmsy_region_map.png"), dpi = 200, width = 7, height = 5)

# Weighted Mean
w_mean_b_v_bmsy_region_map <- MapMaker(data = upsides_region, 
                                     res = "region",
                                     fill = "w_mean_b_v_bmsy",
                                     fill_name = "B/Bmsy",
                                     fill_breaks = seq(0,2, by = 0.5),
                                     fill_limits = c(0,2),
                                     fill_labels = c("0", "0.5", "1", "1.5", "\u2265 2"),
                                     land_sf = world_land,
                                     region_sf = fao_regions)

ggsave(paste0(results_dir, "w_mean_b_v_bmsy_region_map.png"), dpi = 200, width = 7, height = 5)

# Combine into three panel
b_v_bmsy_region_legend <- get_legend(w_mean_b_v_bmsy_region_map)

b_v_bmsy_region_map <- plot_grid(median_b_v_bmsy_region_map + theme(legend.position = "none"),
                                 mean_b_v_bmsy_region_map + theme(legend.position = "none"),
                                 w_mean_b_v_bmsy_region_map + theme(legend.position = "none"),
                                 b_v_bmsy_region_legend,
                                 ncol = 1,
                                 rel_heights = c(1, 1, 1, 0.2),
                                 labels = c("A) Median", "B) Mean", "C) Weighted Mean", ""),
                                 label_x = c(-0.04, -0.03, -0.1, 0),
                                 align = "v")

b_v_bmsy_region_map
ggsave(paste0(results_dir, "b_v_bmsy_region_map.png"), dpi = 200, width = 7, height = 12.5)
```

## Coorelation Between Subsidies and Stock status 

```{r}
subsidy_intensity_upsides_region <- upsides_region %>%
  left_join(subsidy_intensity_region, by = "fao_region")
```

```{r}
# Set some plot scales
subs_x <- c(0,2.5)
f_y <- c(0,3)
effort_fill_lim <- c(0,7.5e9)
effort_fill_breaks <- seq(0,7.5e9, length.out = 5)
effort_fill_labels <- format(seq(0,7.5e9, length.out = 5)/1e9, scientific = F, digits = 2)

# Labels
w_mean_subs_label <- "Weighted Mean Subsidy Intensity ($/KWh)"
mean_subs_label <- "Mean Subsidy Intensity ($/KWh)"
median_subs_label <- "Median Subsidy Intensity ($/KWh)"

w_mean_f_label <- "Weighted Mean F/Fmsy"
mean_f_label <- "Mean F/Fmsy"
median_f_label <- "Median F/Fmsy"

effort_label <- "Total Fishing Effort \n(KWh, billions)"
```


### Use Weighted Mean Subsidies

#### Total Subsidies

```{r}
# Weighted Mean Total Subs vs Median F/Fmsy [LAST]
w_mean_tot_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_tot_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Total Subs vs Mean F/Fmsy [BEST]
w_mean_tot_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_tot_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Total Subs vs Weighted Mean F/Fmsy [SECOND]
w_mean_tot_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_tot_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
corr_legend <- get_legend(w_mean_tot_vs_w_mean_f_v_fmsy_plot)

w_mean_tot_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(w_mean_tot_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            w_mean_tot_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            w_mean_tot_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

w_mean_tot_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "w_mean_tot_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)
```

#### Bad Subsidies

```{r}
# Weighted Mean Bad Subs vs Median F/Fmsy [BEST!]
w_mean_B_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_B_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Bad Subs vs Mean F/Fmsy [LAST]
w_mean_B_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_B_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Total Subs vs Weighted Mean F/Fmsy [SECOND]
w_mean_B_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_B_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
w_mean_B_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(w_mean_B_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            w_mean_B_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            w_mean_B_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

w_mean_B_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "w_mean_B_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)
```

#### Bad + Ambiguous Subsidies

```{r}
# Weighted Mean Bad + Ambiguous Subs vs Median F/Fmsy [BEST]
w_mean_BC_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_BC_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Bad + Ambiguous Subs vs Mean F/Fmsy [LAST]
w_mean_BC_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_BC_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Total Subs vs Weighted Mean F/Fmsy [SECOND]
w_mean_BC_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "w_mean_BC_subs_KWh",
                                       x_name = w_mean_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
w_mean_BC_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(w_mean_BC_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            w_mean_BC_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            w_mean_BC_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

w_mean_BC_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "w_mean_BC_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)
```

### Use Mean Subsidies

#### Total Subsidies

```{r}
# Mean Total Subs vs Median F/Fmsy [BEST]
mean_tot_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_tot_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

ggsave(paste0(results_dir, "mean_tot_vs_median_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 7)

# Mean Total Subs vs Mean F/Fmsy [LAST]
mean_tot_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_tot_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

ggsave(paste0(results_dir, "mean_tot_vs_mean_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 7)

# Mean Total Subs vs Weighted Mean F/Fmsy [SECOND]
mean_tot_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_tot_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

ggsave(paste0(results_dir, "mean_tot_vs_w_mean_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 7)

# Combine into three panel
mean_tot_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(mean_tot_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            mean_tot_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            mean_tot_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

mean_tot_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "mean_tot_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)
```

#### Bad Subsidies

```{r}
# Weighted Mean Bad Subs vs Median F/Fmsy [SECOND]
mean_B_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_B_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Bad Subs vs Mean F/Fmsy [LAST]
mean_B_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_B_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Weighted Mean Total Subs vs Weighted Mean F/Fmsy [BEST]
mean_B_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_B_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
mean_B_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(mean_B_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            mean_B_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            mean_B_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

mean_B_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "mean_B_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)
```

#### Bad + Ambiguous Subsidies

```{r}
# Mean Bad + Ambiguous Subs vs Median F/Fmsy [SECOND]
mean_BC_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_BC_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Mean Bad + Ambiguous Subs vs Mean F/Fmsy [LAST]
mean_BC_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_BC_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Mean Total Subs vs Weighted Mean F/Fmsy [BEST]
mean_BC_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "mean_BC_subs_KWh",
                                       x_name = mean_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
mean_BC_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(mean_BC_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            mean_BC_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            mean_BC_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

mean_BC_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "mean_BC_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)

```

### Use Median Subsidies

#### Total Subsidies

```{r}
# Median Total Subs vs Median F/Fmsy [BAD]
median_tot_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_tot_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Median Total Subs vs Mean F/Fmsy [BAD]
median_tot_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_tot_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Median Total Subs vs Weighted Mean F/Fmsy [BEST]
median_tot_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_tot_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
median_tot_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(median_tot_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            median_tot_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            median_tot_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

median_tot_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "median_tot_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)

```

#### Bad Subsidies

```{r}
# Median Bad Subs vs Median F/Fmsy [BAD]
median_B_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_B_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Median Bad Subs vs Mean F/Fmsy [BAD]
median_B_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_B_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Median Total Subs vs Weighted Mean F/Fmsy [MEH]
median_B_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_B_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
median_B_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(median_B_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            median_B_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            median_B_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

median_B_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "median_B_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)
```

#### Bad + Ambiguous Subsidies

```{r}
# Median Bad + Ambiguous Subs vs Median F/Fmsy [BAD]
median_BC_vs_median_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_BC_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "med_f_v_fmsy",
                                       y_name = median_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Median Bad + Ambiguous Subs vs Mean F/Fmsy [MEH]
median_BC_vs_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_BC_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "mean_f_v_fmsy",
                                       y_name = mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Median Total Subs vs Weighted Mean F/Fmsy [MEH]
median_BC_vs_w_mean_f_v_fmsy_plot <- MapMaker(data = subsidy_intensity_upsides_region,
                                       res = "corr",
                                       x = "med_BC_subs_KWh",
                                       x_name = median_subs_label,
                                       x_limits = subs_x,
                                       y = "w_mean_f_v_fmsy",
                                       y_name = w_mean_f_label,
                                       y_limits = f_y,
                                       fill = "tot_fishing_KWh",
                                       fill_name = effort_label,
                                       fill_limits = effort_fill_lim,
                                       fill_breaks = effort_fill_breaks,
                                       fill_labels = effort_fill_labels)

# Combine into three panel
median_BC_vs_f_v_fmsy_plot <- plot_grid(
  
  plot_grid(median_BC_vs_median_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            median_BC_vs_mean_f_v_fmsy_plot + theme(legend.position = "none", axis.title.x = element_blank()),
            median_BC_vs_w_mean_f_v_fmsy_plot + theme(legend.position = "none"),
            ncol = 1,
            align = "hv"),
  corr_legend,
  ncol = 1,
  rel_heights = c(3, 0.2))

median_BC_vs_f_v_fmsy_plot
ggsave(paste0(results_dir, "median_BC_vs_f_v_fmsy_plot.png"), dpi = 200, width = 7, height = 12.5)

```

## Figure 1

```{r}
top_legend <- get_legend(w_mean_subsidy_intensity_BC_region_map)

top_row <- plot_grid(
  plot_grid(w_mean_subsidy_intensity_BC_grid_map + theme(legend.position = "none"),
                     w_mean_subsidy_intensity_BC_region_map + theme(legend.position = "none"),
                     nrow = 1,
                     label_x = 0,
                     labels = c("A) Subsidy Itensity (1x1 degree)",
                                "B) Subsidy Intensity (FAO Region)")),
  ncol = 1,
  top_legend,
  rel_heights = c(1,0.2))


bottom_row <-  plot_grid(median_f_v_fmsy_region_map,
                     w_mean_BC_vs_median_f_v_fmsy_plot,
                     nrow = 1,
                     label_x = 0,
                     labels = c("C) F/Fmsy (FAO Region)",
                                "D) Coorelation"))

Figure1 <- plot_grid(top_row,
                     bottom_row,
                     nrow = 2)
         
ggsave(paste0(results_dir, "Figure1.png"), dpi = 200, width = 14, height = 9.5)
```


