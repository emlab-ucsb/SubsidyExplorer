---
output:
  html_document: default

title: "SubsidyExplorer - Step 0: Data Wrangling"
author: "Kat Millage, Vienna Saccomanno, Laura Lea Rubino, Christopher Costello"
date: "`r format(Sys.time(), '%B %d, %Y')`"
fontsize: 11pt
---

```{r setup, include=FALSE}
library(knitr) 
library(countrycode) # country name matching
library(WDI) # World Bank GDP and population numbers by country
library(janitor) # cleaning column names
library(tidyverse)
library(readxl)
```

```{r}
# Code options
knitr::opts_chunk$set(echo = FALSE, error = FALSE, message = FALSE, warning = F)

# Directories for the output files generated by this script
data_dir <- here::here("data", "edited/")
if (dir.exists(data_dir) == F) {
  dir.create(data_dir, recursive = T)
}

app_data_dir <- here::here("app", "data/")
if (dir.exists(app_data_dir) == F) {
  dir.create(app_data_dir, recursive = T)
}


results_dir <- here::here("results", "00-data-wrangling/")
if (dir.exists(results_dir) == F) {
  dir.create(results_dir, recursive = T)
}

```

## Introduction

This script handles the preliminary data wrangling for the raw datasets underlying the SubsidyExplorer toolkit. It outputs tidyed data files to `r data_dir`. 

It also creates and outputs four aggregated CSV files that are used as input data by the SubsidyExplorer toolkit (saved to `r app_data_dir`): 
- subsidies-2009-2018-tidy.csv
- demographic-2000-2018-tidy.csv
- fisheries-2000-2017.csv
- fao-landings-group-2000-2017.csv

Summary figures are exported to `r results_dir`.  

```{r}
# Paths to subsidies data files
sumaila_subsidies_path <- here::here("data", "raw", "Sumaila-et-al-2019-subsidies", "Subsidies_PEW_Final.xlsx")
oecd_fse_path <- here::here("data", "raw", "OECD-2019-fse", "FISH_FSE_10032020183349581.csv")

# Paths to demographic data files
fao_fishers_path <- here::here("data", "raw", "FAO-2019-yearbook", "fao_fishers_yearbook_070619.csv")
teh_fte_path <- here::here("data", "raw", "Teh-and-Sumaila-2013-fte", "Fisher employment FTE.xlsx")

# Paths to fisheries data files
fao_production_path <- here::here("data", "raw", "FAO-2019-capture-production", "TS_FI_CAPTURE.csv")
#fao_value_path
melnychuk_price_path <- here::here("data", "raw", "Melnychuk-et-al-2013-price", "Melnychuk_Exvessel_Price_Database.csv")

# Paths to misc data files 
costello_upsides_path <- here::here("data", "raw", "Costello-et-al-2016-upsides", "ProjectionData_2012.csv")
iuu_vessel_path <- here::here("data", "raw", "IUU-Vessel-List-2019", "IUUList-20190430.csv")
ram_sadb_path <- here::here("data", "raw", "RAM-2018-stock-assessment-database", "RLSADB v4.40", "DB Files With Assessment Data", "RLSADB v4.40 (assessment data only).xlsx")
```

The following data sources are included in this analysis: 

Estimates of annual fisheries subsidies provision by state from Sumaila et al. (2019) in 2018 US\$. These data were provided to us directly by the authors as a .xlsx file and are stored at `r sumaila_subsidies_path`.
> Sumaila, U. R., Ebrahim, N., Schuhbauer, A., Skerritt, D., Li, Y., Kim, H. S., … Pauly, D. (2019). Updated estimates and analysis of global fisheries subsidies. Marine Policy, 109, 103695. https://doi.org/10.1016/j.marpol.2019.103695

Estimates of fisheries support provision by state from the OECD (2008 - 2018). These data were last downloaded from the OECD iLibrary portal as a CSV file on March 10, 2019 and are stored as `r oecd_fse_path`.
> OECD (2019), "Fisheries: Fisheries support estimates", OECD Agriculture Statistics (database), https://doi.org/10.1787/ade64fdc-en (accessed on 10 March 2019).

Total GDP and population by state from the World Bank's World Development Indicators Database (2000 - 2018). These data were accessed through the `WDI` package. The code used to pull the data is below. 
> The World Bank (2019). "World Development Indicators", https://datacatalog.worldbank.org/dataset/world-development-indicators (accessed on 24 October 2019). 

Total number of fishers by state from the FAO Yearbook of Fishery and Aquaculture Statistics (misc. years between 1995 and 2017). These data were manually transcribed from PDF (`./data/raw/fleet_&_employment.pdf`) to CSV format on July 6, 2019 and are stored as `r fao_fishers_path`. 
> FAO (2019). FAO yearbook. Fishery and Aquaculture Statistics 2017, http://www.fao.org/fishery/statistics/global-fishers/en (accessed on 24 October 2019). 

Estimated number of full-time jobs in fisheries from Teh and Sumaila (2013) in 2003. These data were provided to us directly by the authors as a .xlsx file and are stored as `r teh_fte_path`. 
> Teh, L. C. L., & Sumaila, U. R. (2011). Contribution of marine fisheries to worldwide employment. Fish and Fisheries, 14(1), 77–88. https://doi.org/10.1111/j.1467-2979.2011.00450.x

Fisheries landings  in 2017 from the FAO Global Capture Production database (2019) and estimates of landed value generated using the ex-vessel price database created by Melnychuk et al. (2017). These data were were wrangled in the previous script, and the edited data are stored as `r catch_dat_path`. 
> FAO (2019). FAO yearbook. Fishery and Aquaculture Statistics 2017, http://www.fao.org/fishery/statistics/global-capture-production/en (accessed on 24 October 2019). 
> Melnychuk, M. C., Clavelle, T., Owashi, B., & Strauss, K. (2017). Reconstruction of global ex-vessel prices of fished species. ICES Journal of Marine Science, 74(1), 121–133. https://doi.org/10.1093/icesjms/fsw169

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
